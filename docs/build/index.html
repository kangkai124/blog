<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>npm scripts 打造前端工作流 | KK | FE</title>
    <meta name="description" content="Code, Guitar, Photography, and Sports">
    <link rel="icon" href="/blog/logo_small.jpg">
  <link rel="manifest" href="/blog/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/blog/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.00b81b5a.css" as="style"><link rel="preload" href="/blog/assets/js/app.d8042286.js" as="script"><link rel="preload" href="/blog/assets/js/33.b92e4609.js" as="script"><link rel="prefetch" href="/blog/assets/js/1.30b2587f.js"><link rel="prefetch" href="/blog/assets/js/2.ca22baaf.js"><link rel="prefetch" href="/blog/assets/js/3.174657bf.js"><link rel="prefetch" href="/blog/assets/js/4.adf40659.js"><link rel="prefetch" href="/blog/assets/js/5.df7f55d9.js"><link rel="prefetch" href="/blog/assets/js/6.9be065d6.js"><link rel="prefetch" href="/blog/assets/js/7.526ddef5.js"><link rel="prefetch" href="/blog/assets/js/8.c1091489.js"><link rel="prefetch" href="/blog/assets/js/9.19f5d287.js"><link rel="prefetch" href="/blog/assets/js/10.62342e6f.js"><link rel="prefetch" href="/blog/assets/js/11.34067726.js"><link rel="prefetch" href="/blog/assets/js/12.404a2c78.js"><link rel="prefetch" href="/blog/assets/js/13.26fcfe49.js"><link rel="prefetch" href="/blog/assets/js/14.853db56f.js"><link rel="prefetch" href="/blog/assets/js/15.a0676c31.js"><link rel="prefetch" href="/blog/assets/js/16.d0a947f8.js"><link rel="prefetch" href="/blog/assets/js/17.77d27c46.js"><link rel="prefetch" href="/blog/assets/js/18.612d4520.js"><link rel="prefetch" href="/blog/assets/js/19.2b375517.js"><link rel="prefetch" href="/blog/assets/js/20.78ba3417.js"><link rel="prefetch" href="/blog/assets/js/21.8f333a4d.js"><link rel="prefetch" href="/blog/assets/js/22.3d596f81.js"><link rel="prefetch" href="/blog/assets/js/23.567394cc.js"><link rel="prefetch" href="/blog/assets/js/24.86ac1b5d.js"><link rel="prefetch" href="/blog/assets/js/25.3b9c0cd6.js"><link rel="prefetch" href="/blog/assets/js/26.033688e9.js"><link rel="prefetch" href="/blog/assets/js/27.bdb536ec.js"><link rel="prefetch" href="/blog/assets/js/28.9c0a483e.js"><link rel="prefetch" href="/blog/assets/js/29.f40ca1bf.js"><link rel="prefetch" href="/blog/assets/js/30.d13bd8a5.js"><link rel="prefetch" href="/blog/assets/js/31.9ba48c74.js"><link rel="prefetch" href="/blog/assets/js/32.cbe3562e.js"><link rel="prefetch" href="/blog/assets/js/34.50e0a4d1.js"><link rel="prefetch" href="/blog/assets/js/35.c5742db4.js"><link rel="prefetch" href="/blog/assets/js/36.4857bad9.js"><link rel="prefetch" href="/blog/assets/js/37.33ba67b8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.00b81b5a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><!----><span class="site-name">
      KK | FE
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/blog/javaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----><a href="/blog/html-css/" class="nav-link">html/css</a></li><li class="dropdown-item"><!----><a href="/blog/react-vue/" class="nav-link">react/vue</a></li><li class="dropdown-item"><!----><a href="/blog/nodeJs/" class="nav-link">nodeJs</a></li><li class="dropdown-item"><!----><a href="/blog/build/" class="nav-link router-link-exact-active router-link-active">build</a></li><li class="dropdown-item"><!----><a href="/blog/thoughts/" class="nav-link">thoughts</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">转载</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/blog/share/k2data/" class="nav-link">K2data</a></li><li class="dropdown-item"><!----><a href="/blog/share/fe/" class="nav-link">博客</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">摄影</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://kangkai.tuchong.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----><a href="/blog/photo/" class="nav-link">原创文章</a></li></ul></div></div><a href="https://github.com/kangkai124" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/blog/javaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----><a href="/blog/html-css/" class="nav-link">html/css</a></li><li class="dropdown-item"><!----><a href="/blog/react-vue/" class="nav-link">react/vue</a></li><li class="dropdown-item"><!----><a href="/blog/nodeJs/" class="nav-link">nodeJs</a></li><li class="dropdown-item"><!----><a href="/blog/build/" class="nav-link router-link-exact-active router-link-active">build</a></li><li class="dropdown-item"><!----><a href="/blog/thoughts/" class="nav-link">thoughts</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">转载</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/blog/share/k2data/" class="nav-link">K2data</a></li><li class="dropdown-item"><!----><a href="/blog/share/fe/" class="nav-link">博客</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">摄影</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://kangkai.tuchong.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----><a href="/blog/photo/" class="nav-link">原创文章</a></li></ul></div></div><a href="https://github.com/kangkai124" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><div class="carbon-ads"></div><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>项目构建</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/blog/build/" class="active sidebar-link">npm scripts 打造前端工作流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/build/#npm-script-命令" class="sidebar-link">npm script 命令</a></li><li class="sidebar-sub-header"><a href="/blog/build/#运行多个-npm-script-命令" class="sidebar-link">运行多个 npm script 命令</a></li><li class="sidebar-sub-header"><a href="/blog/build/#给-npm-script-传参" class="sidebar-link">给 npm script 传参</a></li><li class="sidebar-sub-header"><a href="/blog/build/#npm-script-钩子" class="sidebar-link">npm script 钩子</a></li><li class="sidebar-sub-header"><a href="/blog/build/#在-npm-script-中使用变量" class="sidebar-link">在 npm script 中使用变量</a></li><li class="sidebar-sub-header"><a href="/blog/build/#npm-命令行自动补全" class="sidebar-link">npm 命令行自动补全</a></li><li class="sidebar-sub-header"><a href="/blog/build/#npm-script-跨平台兼容" class="sidebar-link">npm script 跨平台兼容</a></li><li class="sidebar-sub-header"><a href="/blog/build/#把庞大的-npm-script-拆到单独的文件中" class="sidebar-link">把庞大的 npm script 拆到单独的文件中</a></li><li class="sidebar-sub-header"><a href="/blog/build/#nodejs-脚本代替复杂的-npm-script" class="sidebar-link">NodeJs 脚本代替复杂的 npm script</a></li><li class="sidebar-sub-header"><a href="/blog/build/#livereload-自动刷新" class="sidebar-link">livereload 自动刷新</a></li><li class="sidebar-sub-header"><a href="/blog/build/#git-hooks-运行-npm-script" class="sidebar-link">git hooks 运行 npm script</a></li><li class="sidebar-sub-header"><a href="/blog/build/#npm-script-实现构建流水线" class="sidebar-link">npm script 实现构建流水线</a></li></ul></li><li><a href="/blog/build/webpack.html" class="sidebar-link">使用 webpack 定制前端开发环境</a></li><li><a href="/blog/build/docker.html" class="sidebar-link">学习 docker</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="npm-scripts-打造前端工作流"><a href="#npm-scripts-打造前端工作流" aria-hidden="true" class="header-anchor">#</a> npm scripts 打造前端工作流</h1><blockquote><p>代码在<a href="https://github.com/kangkai124/IdontknowJS/tree/master/projects/automated-workflow-with-npm-script" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote><h2 id="npm-script-命令"><a href="#npm-script-命令" aria-hidden="true" class="header-anchor">#</a> npm script 命令</h2><p><em>npm init -y</em> 或者 <em>npm init -f</em> 跳过参数问答，快速生成 package.json。</p><p>shell 命令修改默认配置：</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> config <span class="token keyword">set</span> init.author.email <span class="token string">&quot;kkstrive0124@gmail.com&quot;</span>
<span class="token function">npm</span> config <span class="token keyword">set</span> init.author.name <span class="token string">&quot;kangkai&quot;</span>
<span class="token function">npm</span> config <span class="token keyword">set</span> init.author.url <span class="token string">&quot;https://github.com/kangkai124&quot;</span>
<span class="token function">npm</span> config <span class="token keyword">set</span> init.license <span class="token string">&quot;MIT&quot;</span>
<span class="token function">npm</span> config <span class="token keyword">set</span> init.version <span class="token string">&quot;0.1.0&quot;</span>
</code></pre></div><p><em>npm run</em> 是 npm 内置的核心功能之一， 当运行 <em>npm run xx</em> 时：</p><ol><li>从 package.json 文件中读取 scripts 对象里面的全部配置</li><li>以 xx 为键，在 scripts 对象里获取对应的值做为接下来要执行的命令，没找到报错</li><li>在 shell 中执行上述命令</li></ol><p>执行 <em>npm run</em> 不带任何参数，列出可执行的所有命令。</p><h2 id="运行多个-npm-script-命令"><a href="#运行多个-npm-script-命令" aria-hidden="true" class="header-anchor">#</a> 运行多个 npm script 命令</h2><p>安利常用的 4 种代码检查：</p><ol><li><a href="https://link.juejin.im/?target=https%3A%2F%2Feslint.org" target="_blank" rel="noopener noreferrer">eslint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可定制的 js 代码检查</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fstylelint.io" target="_blank" rel="noopener noreferrer">stylelint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可定制的样式文件检查，支持 css、less、scss</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fzaach%2Fjsonlint" target="_blank" rel="noopener noreferrer">jsonlint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，json 文件语法检查，踩过坑的同学会清楚，json 文件语法错误会知道导致各种失败</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Figorshubovych%2Fmarkdownlint-cli" target="_blank" rel="noopener noreferrer">markdownlint-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Markdown 文件最佳实践检查，个人偏好</li></ol><p>单元测试：</p><ol><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fmochajs.org" target="_blank" rel="noopener noreferrer">mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，测试用例组织，测试用例运行和结果收集的框架；</li><li><a href="https://link.juejin.im/?target=http%3A%2F%2Fchaijs.com" target="_blank" rel="noopener noreferrer">chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，测试断言库，必要的时候可以结合 <a href="https://link.juejin.im/?target=http%3A%2F%2Fsinonjs.org" target="_blank" rel="noopener noreferrer">sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用；</li></ol><h4 id="多个-npm-script-串行"><a href="#多个-npm-script-串行" aria-hidden="true" class="header-anchor">#</a> 多个 npm script 串行</h4><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp;&amp; npm run lint:css &amp;&amp; npm run lint:json &amp;&amp; npm run lint:markdown &amp;&amp; mocha tests/&quot;</span>
</code></pre></div><p>串行执行的时候，如果前面的命令失败，后续的都会终止。</p><h4 id="多个-npm-script-并行"><a href="#多个-npm-script-并行" aria-hidden="true" class="header-anchor">#</a> 多个 npm script 并行</h4><p>在严格串行的情况下，我们必须要确保代码中没有编码规范问题才能运行测试，在某些时候可能并不是我们想要的，因为我们真正需要的是，代码变更时同时给出测试结果和测试运行结果。这就需要把子命令的运行从串行改成并行，实现方式更简单，把连接多条命令的 <strong>&amp;&amp;</strong> 符号替换成 <strong>&amp;</strong> 即可。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp; npm run lint:css &amp; npm run lint:json &amp; npm run lint:markdown &amp; mocha tests/&quot;</span>
</code></pre></div><p>在命令的最后增加 <strong>&amp; wait</strong> ，如果我们在任何子命令中启动了长时间运行的进程，比如启动了 mocha 的 <strong>—watch</strong> 配置，可以使用 <strong>Ctrl + c</strong> 结束进程。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp; npm run lint:css &amp; npm run lint:json &amp; npm run lint:markdown &amp; mocha tests/ &amp; wait&quot;</span>
</code></pre></div><h4 id="更好的管理方式"><a href="#更好的管理方式" aria-hidden="true" class="header-anchor">#</a> 更好的管理方式</h4><p><a href="https://github.com/mysticatea/npm-run-all" target="_blank" rel="noopener noreferrer">npm-run-all<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="给-npm-script-传参"><a href="#给-npm-script-传参" aria-hidden="true" class="header-anchor">#</a> 给 npm script 传参</h2><p>简单粗暴方法：</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;lint:js:fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js --fix&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p>当 <em>lint:js</em> 命令变长之后，可能会忘记修改 <em>lint:js:fix</em> ，所以更健壮的做法是，在运行 <em>npm script</em> 是给定额外的参数。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;lint:js:fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js -- --fix&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p>要格外注意 <code>--fix</code> 参数前面的 <code>--</code> 分隔符，意指要给 <code>npm run lint:js</code> 实际指向的命令传递额外的参数。</p><h2 id="npm-script-钩子"><a href="#npm-script-钩子" aria-hidden="true" class="header-anchor">#</a> npm script 钩子</h2><p><em>pre</em> 和 <em>post</em> ：</p><p>举例来说，运行 npm run test 的时候，分 3 个阶段：</p><ol><li>检查 scripts 对象中是否存在 pretest 命令，如果有，先执行该命令</li><li>检查是否有 test 命令，有的话运行 test 命令，没有的话报错</li><li>检查是否存在 posttest 命令，如果有，执行 posttest 命令</li></ol><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;precover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf coverage&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;cover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nyc --reporter=html npm test&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;postcover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf .nyc_output &amp;&amp; opn coverage/index.html&quot;</span>
</code></pre></div><h2 id="在-npm-script-中使用变量"><a href="#在-npm-script-中使用变量" aria-hidden="true" class="header-anchor">#</a> 在 npm script 中使用变量</h2><p>通过运行 <code>npm run env</code> 就能拿到完整的变量列表。</p><p><code>npm run env | grep npm_package | sort</code> 拿到部分排序后的预定义环境变量：</p><div class="language-shell extra-class"><pre class="language-shell"><code>// 作者信息<span class="token punctuation">..</span>.
npm_package_author_email<span class="token operator">=</span>wangshijun2010@gmail.com
npm_package_author_name<span class="token operator">=</span>wangshijun
npm_package_author_url<span class="token operator">=</span>http://github.com/wangshijun
// 依赖信息<span class="token punctuation">..</span>.
npm_package_devDependencies_markdownlint_cli<span class="token operator">=</span>^0.5.0
npm_package_devDependencies_mocha<span class="token operator">=</span>^4.0.1
npm_package_devDependencies_npm_run_all<span class="token operator">=</span>^4.1.2
// 各种 <span class="token function">npm</span> script
npm_package_scripts_lint<span class="token operator">=</span>npm-run-all --parallel lint:*
npm_package_scripts_lint_css<span class="token operator">=</span>stylelint *.less
npm_package_scripts_lint_js<span class="token operator">=</span>eslint *.js
npm_package_scripts_lint_js_fix<span class="token operator">=</span>npm run lint:js -- --fix
npm_package_scripts_lint_json<span class="token operator">=</span>jsonlint --quiet *.json
// 基本信息
npm_package_version<span class="token operator">=</span>0.1.0
npm_package_gitHead<span class="token operator">=</span>3796e548cfe406ec33ab837ac00bcbd6ee8a38a0
npm_package_license<span class="token operator">=</span>MIT
npm_package_main<span class="token operator">=</span>index.js
npm_package_name<span class="token operator">=</span>hello-npm-script
npm_package_readmeFilename<span class="token operator">=</span>README.md
// 依赖的配置
npm_package_nyc_exclude_0<span class="token operator">=</span>**/*.spec.js
npm_package_nyc_exclude_1<span class="token operator">=</span>.*.js
</code></pre></div><p>变量的使用方法遵循 shell 里面的语法，直接在 npm script 给想要引用的变量前面加上 <em>$</em> 符号即可。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;cover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nyc --reporter=html npm test&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;cover:cleanup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf coverage &amp;&amp; rm -rf .nyc_output&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;cover:archive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mkdir -p coverage_archive/k-script-$npm_package_version &amp;&amp; cp -r coverage/* coverage_archive/k-script-$npm_package_version&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;postcover&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run cover:archive &amp;&amp; npm run cover:cleanup &amp;&amp; opn coverage_archive/k-script-$npm_package_version/index.html&quot;</span>
</code></pre></div><p><em>cover:archive</em> 做了 2 件事情：</p><ol><li><em>mkdir -p coverage_archive/$npm_package_version</em> 准备当前版本号的归档目录</li><li><em>cp -r coverage/</em> coverage_archive/$npm_package_version*，直接复制文件来归档</li></ol><p>而 <em>postcover</em> 做了 3 件事情：</p><ol><li><em>npm run cover:archive</em>，归档本次覆盖率报告</li><li><em>npm run cover:cleanup</em>，清理本次覆盖率报告</li><li><em>opn coverage_archive/$npm_package_version/index.html</em>，直接预览覆盖率报告</li></ol><h2 id="npm-命令行自动补全"><a href="#npm-命令行自动补全" aria-hidden="true" class="header-anchor">#</a> npm 命令行自动补全</h2><h4 id="npm-run-less"><a href="#npm-run-less" aria-hidden="true" class="header-anchor">#</a> npm run | less</h4><p>使用 <em>/</em> 进入搜索模式</p><h4 id="npm-completion-集成到-shell-中"><a href="#npm-completion-集成到-shell-中" aria-hidden="true" class="header-anchor">#</a> npm completion 集成到 shell 中</h4><p>npm 自身提供了自动完成工具 <a href="https://link.juejin.im/?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fcompletion" target="_blank" rel="noopener noreferrer">completion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，将其集成到 <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.gnu.org%2Fsoftware%2Fbash" target="_blank" rel="noopener noreferrer">bash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或者 <a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Frobbyrussell%2Foh-my-zsh" target="_blank" rel="noopener noreferrer">zsh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 里也非常容易。</p><p>官方文档里面的集成方法如下：</p><div class="language- extra-class"><pre class="language-text"><code>npm completion &gt;&gt; ~/.bashrc
npm completion &gt;&gt; ~/.zshrc
</code></pre></div><p>如果你也有代码洁癖，为了保持 .zshrc 或者 .bashrc 文件的整洁，可以用下面的方法：</p><p>第 1 步，把 npm completion 产生的那坨命令放在单独的文件中：</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> completion <span class="token operator">&gt;&gt;</span> ~/.npm-completion.bash
</code></pre></div><p>第 2 步，在 .bashrc 或者 .zshrc 中引入这个文件：</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token keyword">echo</span> <span class="token string">&quot;[ -f ~/.npm-completion.bash ] &amp;&amp; source ~/.npm-completion.bash;&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
<span class="token keyword">echo</span> <span class="token string">&quot;[ -f ~/.npm-completion.bash ] &amp;&amp; source ~/.npm-completion.bash;&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc
</code></pre></div><blockquote><p>TIP：执行完上面的命令一定要记得 <em>source ~/.zshrc</em> 或者 <em>source ~/.bashrc</em></p></blockquote><h4 id="更高级的自动补全"><a href="#更高级的自动补全" aria-hidden="true" class="header-anchor">#</a> 更高级的自动补全</h4><p><a href="https://github.com/lukechilds/zsh-better-npm-completion" target="_blank" rel="noopener noreferrer">zsh-better-npm-completion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://github.com/mklabs/yarn-completions" target="_blank" rel="noopener noreferrer">yarn-completions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="npm-script-跨平台兼容"><a href="#npm-script-跨平台兼容" aria-hidden="true" class="header-anchor">#</a> npm script 跨平台兼容</h2><h4 id="文件系统操作的跨平台兼容"><a href="#文件系统操作的跨平台兼容" aria-hidden="true" class="header-anchor">#</a> 文件系统操作的跨平台兼容</h4><ul><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fisaacs%2Frimraf" target="_blank" rel="noopener noreferrer">rimraf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或 <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdel-cli" target="_blank" rel="noopener noreferrer">del-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，用来删除文件和目录，实现类似于 <code>rm -rf</code> 的功能</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcpr" target="_blank" rel="noopener noreferrer">cpr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，用于拷贝、复制文件和目录，实现类似于 <code>cp -r</code> 的功能</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fmake-dir-cli" target="_blank" rel="noopener noreferrer">make-dir-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，用于创建目录，实现类似于 <code>mkdir -p</code> 的功能</li></ul><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i rimraf cpr make-dir-cli -D
<span class="token comment"># npm install rimraf cpr make-dir-cli --save-dev</span>
<span class="token comment"># yarn add rimraf cpr make-dir-cli -D</span>
</code></pre></div><h4 id="用-cross-var-引用变量"><a href="#用-cross-var-引用变量" aria-hidden="true" class="header-anchor">#</a> 用 cross-var 引用变量</h4><p>Linux 下直接可以用 <code>$npm_package_name</code>，而 Windows 下必须使用 <code>%npm_package_name%</code>，我们可以使用 <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcross-var" target="_blank" rel="noopener noreferrer">cross-var<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现跨平台的变量引用:</p><div class="language-patch extra-class"><pre class="language-text"><code>&quot;scripts&quot;: {
     &quot;cover:cleanup&quot;: &quot;rm -rf coverage &amp;&amp; rm -rf .nyc_output&quot;,
-    &quot;cover:archive&quot;: &quot;mkdir -p coverage_archive/$npm_package_version &amp;&amp; cp -r coverage/* coverage_archive/$npm_package_version&quot;,
-    &quot;cover:serve&quot;: &quot;http-server coverage_archive/$npm_package_version -p $npm_package_config_port&quot;,
-    &quot;cover:open&quot;: &quot;opn http://localhost:$npm_package_config_port&quot;,
+    &quot;cover:archive&quot;: &quot;cross-var \&quot;mkdir -p coverage_archive/$npm_package_version &amp;&amp; cp -r coverage/* coverage_archive/$npm_package_version\&quot;&quot;,
+    &quot;cover:serve&quot;: &quot;cross-var http-server coverage_archive/$npm_package_version -p $npm_package_config_port&quot;,
+    &quot;cover:open&quot;: &quot;cross-var opn http://localhost:$npm_package_config_port&quot;,
     &quot;postcover&quot;: &quot;npm-run-all cover:archive cover:cleanup --parallel cover:serve cover:open&quot;
   }
</code></pre></div><h4 id="用-cross-env-设置环境变量"><a href="#用-cross-env-设置环境变量" aria-hidden="true" class="header-anchor">#</a> 用 cross-env 设置环境变量</h4><p>第 1 步，添加 cross-env 到开发依赖：</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i cross-env -D
</code></pre></div><p>第 2 步，改写使用了环境变量的 npm script：</p><div class="language-patch extra-class"><pre class="language-text"><code> &quot;scripts&quot;: {
- &quot;test&quot;: &quot;NODE_ENV=test mocha tests/&quot;,
+ &quot;test&quot;: &quot;cross-env NODE_ENV=test mocha tests/&quot;,
  },
</code></pre></div><h2 id="把庞大的-npm-script-拆到单独的文件中"><a href="#把庞大的-npm-script-拆到单独的文件中" aria-hidden="true" class="header-anchor">#</a> 把庞大的 npm script 拆到单独的文件中</h2><p>借助 <a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Ftestdouble%2Fscripty" target="_blank" rel="noopener noreferrer">scripty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 我们可以将 npm script 剥离到单独的文件中。</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i scripty -D

<span class="token function">mkdir</span> -p scripts/cover

<span class="token function">touch</span> scripts/cover.sh
<span class="token function">touch</span> scripts/cover/serve.sh
<span class="token function">touch</span> scripts/cover/open.sh
</code></pre></div><p>然后创建空白的脚本文件，因为有了单独的脚本，我们可以把原来的 precover、cover、postcover、cover:archive、cover:cleanup 合并到一个文件中。</p><p>按照 <em>scripty</em> 的默认约定，npm script 命令和上面各文件的对应关系如下：</p><table><thead><tr><th>命令</th><th>文件</th><th>备注</th></tr></thead><tbody><tr><td>cover</td><td>scripts/cover.sh</td><td>内含 precover、postcover 的逻辑</td></tr><tr><td>cover:serve</td><td>scripts/cover/serve.sh</td><td>启动服务</td></tr><tr><td>cover:open</td><td>scripts/cover/open.sh</td><td>打开预览</td></tr></tbody></table><p><strong>特别注意的是，给所有脚本增加可执行权限是必须的，否则 scripty 执行时会报错，</strong> 我们可以给所有的脚本增加可执行权限：</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">chmod</span> -R a+x scripts/*/.sh
</code></pre></div><p>脚本内容在<a href="../../projects/automated-workflow-with-npm-script/scripts">这里</a>。</p><h2 id="nodejs-脚本代替复杂的-npm-script"><a href="#nodejs-脚本代替复杂的-npm-script" aria-hidden="true" class="header-anchor">#</a> NodeJs 脚本代替复杂的 npm script</h2><p>Node.js 本身是跨平台的，用它编写的脚本出现跨平台兼容问题的概率很小。</p><p>需要用到 <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fshelljs" target="_blank" rel="noopener noreferrer">shelljs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 、 <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk" target="_blank" rel="noopener noreferrer">chalk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token string">&quot;cover&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;node scripts/cover.js&quot;</span>
</code></pre></div><h2 id="livereload-自动刷新"><a href="#livereload-自动刷新" aria-hidden="true" class="header-anchor">#</a> livereload 自动刷新</h2><p>安装 livereload http-server 到 dev 依赖。</p><div class="language-patch extra-class"><pre class="language-text"><code>+    &quot;client&quot;: &quot;npm-run-all --parallel client:*&quot;,
+    &quot;client:reload-server&quot;: &quot;livereload client/&quot;,
+    &quot;client:static-server&quot;: &quot;http-server client/&quot;
</code></pre></div><p>在 html 中嵌入 livereload 脚本：</p><div class="language-patch extra-class"><pre class="language-text"><code>&lt;body&gt;
   &lt;h2&gt;LiveReload Demo&lt;/h2&gt;
+  &lt;script&gt;
+    document.write('&lt;script src=&quot;http://' + (location.host || 'localhost').split(':')[0] +
+      ':35729/livereload.js?snipver=1&quot;&gt;&lt;/' + 'script&gt;')
+  &lt;/script&gt;
 &lt;/body&gt;
</code></pre></div><h2 id="git-hooks-运行-npm-script"><a href="#git-hooks-运行-npm-script" aria-hidden="true" class="header-anchor">#</a> git hooks 运行 npm script</h2><p>安装 <a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Ftypicode%2Fhusky" target="_blank" rel="noopener noreferrer">husky<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fokonet%2Flint-staged" target="_blank" rel="noopener noreferrer">lint-staged<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 到项目 dev 依赖。</p><p>lint-staged ，每个团队成员提交的时候，只检查当次改动的文件。</p><div class="language-patch extra-class"><pre class="language-text"><code>&quot;scripts&quot;: {
-    &quot;precommit&quot;: &quot;npm run lint&quot;,
+    &quot;precommit&quot;: &quot;lint-staged&quot;,
     &quot;prepush&quot;: &quot;npm run test&quot;,
     &quot;lint&quot;: &quot;npm-run-all --parallel lint:*&quot;,
   },
+  &quot;lint-staged&quot;: {
+    &quot;*.js&quot;: &quot;eslint&quot;,
+    &quot;*.less&quot;: &quot;stylelint&quot;,
+    &quot;*.css&quot;: &quot;stylelint&quot;,
+    &quot;*.json&quot;: &quot;jsonlint --quiet&quot;,
+    &quot;*.md&quot;: &quot;markdownlint --config .markdownlint.json&quot;
+  },
</code></pre></div><h2 id="npm-script-实现构建流水线"><a href="#npm-script-实现构建流水线" aria-hidden="true" class="header-anchor">#</a> npm script 实现构建流水线</h2><p>在现代前端项目的交付工作流中，部署前最关键的环节就是构建，构建环节要完成的事情通常包括：</p><ul><li>源代码预编译：比如 less、sass、typescript</li><li>图片优化、雪碧图生成</li><li>JS、CSS 合并、压缩</li><li>静态资源加版本号和引用替换</li><li>静态资源传 CDN 等</li></ul></div><div class="page-nav"><p class="inner"><!----><span class="next"><a href="/blog/build/webpack.html">
          使用 webpack 定制前端开发环境
        </a> →
      </span></p></div><div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div></div></div>
    <script src="/blog/assets/js/33.b92e4609.js" defer></script><script src="/blog/assets/js/app.d8042286.js" defer></script>
  </body>
</html>
